import android.app.ActionBar.LayoutParams;
import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.support.v4.view.ViewPager;
import android.support.v4.view.ViewPager.OnPageChangeListener;
import android.util.Log;
import android.widget.ImageView;
import android.widget.LinearLayout;

public class ViewPagerExamActivity extends Activity {
    /** Called when the activity is first created. */
 private static final String TAG = "ViewPagerExam"; 
 
 private static final int PAGECOUNT = 5;//총페이지 수
 private static final int CURPAGEPOSITION = 5;//초기 지정하고픈 페이지
 private Context mContext;
 private int prePosition;//플리킹 이전 페이지
 
 //Resources
 private ViewPager mPager;
 private LinearLayout curPageMarkLayout;//한 페이지 레이아웃
 
 
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        mContext = this;
        
        initResources();//리소스 초기화
        setViewPagerAdapter();//ViewPager Set
        initPageMark(CURPAGEPOSITION-1);//초기 페이지 마크설정
        mPager.setCurrentItem(CURPAGEPOSITION-1);//초기 ViewPager의 페이지 설정
    }
    
    private void initResources() {
     mPager = (ViewPager)findViewById(R.id.view_pager);
     curPageMarkLayout = (LinearLayout)findViewById(R.id.cur_page_mark);
    }
    
    private void setViewPagerAdapter(){
     ViewPagerAdapter adpater = new ViewPagerAdapter(mContext, PAGECOUNT);
     mPager.setAdapter(adpater);
     mPager.setOnPageChangeListener(new OnPageChangeListener() {
   @Override
   public void onPageScrollStateChanged(int arg0) {
    // TODO Auto-generated method stub    
   }
   @Override
   public void onPageScrolled(int arg0, float arg1, int arg2) {
    // TODO Auto-generated method stub    
   }
   @Override
   public void onPageSelected(int position) {
    // TODO Auto-generated method stub
    Log.i(TAG, "onPageSelcted position = " + position + ", prePosition = " + prePosition);
    curPageMarkLayout.getChildAt(prePosition).setBackgroundResource(R.drawable.page_nor); //이전 페이지에 해당하는 페이지 표시 이미지 변경
    curPageMarkLayout.getChildAt(position).setBackgroundResource(R.drawable.page_selected);  //현재 페이지에 해당하는 페이지 표시 이미지 변경
    prePosition = position;    //이전 포지션 값을 현재로 변경
   }      
     });
    }    
    
    private void initPageMark(int initPosition){
  for( int i=0; i < PAGECOUNT; i++ )
  {
   ImageView iv = new ImageView(mContext); //페이지 표시 이미지 뷰 생성
   iv.setLayoutParams(new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));
   //첫 페이지 표시 이미지 이면 선택된 이미지로
   if(i == initPosition)
    iv.setBackgroundResource(R.drawable.page_selected);
   else //나머지는 선택안된 이미지로
    iv.setBackgroundResource(R.drawable.page_nor);
   //LinearLayout에 추가
   curPageMarkLayout.addView(iv);
  }
  prePosition = initPosition; //이전 포지션 값 초기화
 }
}